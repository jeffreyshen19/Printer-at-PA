/*
 andoverapparel 2018-07-31 
*/

function getWeek(a){var b=new Date,c=chrono.parseDate("This Sunday",a),d=chrono.parseDate("This Saturday",a);return 0===b.getDay()&&(c=chrono.parseDate("Today",a)),6===b.getDay()&&(d=chrono.parseDate("Today",a)),{begin:c,end:d}}function updateDisplay(a){var b=a.begin,c=a.end,d=monthStr[b.getMonth()]+" "+b.getDate(),e="";b.getMonth()==c.getMonth()?e+=c.getDate():e+=monthStr[c.getMonth()]+" "+c.getDate(),$("#date1").text(d),$("#date2").text(e),inWeek({day:chrono.parseDate("today")},b,c)?$("#back").addClass("inactive"):$("#back").removeClass("inactive");for(var f=0;f<=188;f++)$("#"+f).addClass("unfilled").removeClass("filled").text("\b\b");$.get("/getTimeSlots",function(a){a.forEach(function(a){console.log(a),inWeek(a,b,c)&&$("#"+parseTimeObj(a)).removeClass("unfilled").addClass("filled").text(a.email.split("@")[0])})})}function backWeek(){reference=new Date(reference.getTime()-6048e5),updateDisplay(getWeek(reference))}function addWeek(){reference=new Date(reference.getTime()+6048e5),updateDisplay(getWeek(reference))}function today(){reference=chrono.parseDate("today"),updateDisplay(getWeek(reference))}function inWeek(a,b,c){var d=new Date(a.day);return d.getTime()>=b.getTime()&&d.getTime()<=c.getTime()}function parseTimeObj(a){var b=new Date(a.day),c=a.time;return 7*timeStr.indexOf(c)+b.getDay()}function parseId(a){var b=chrono.parseDate("This "+dayStr[a%7],reference);return(new Date).getDay()==a%7&&(b=chrono.parseDate("Today",reference)),{day:b,time:timeStr[Math.floor(a/7)]}}var monthStr=["January","February","March","April","May","June","July","August","September","October","November","December"],reference=chrono.parseDate("today");$(document).ready(function(){var a=location.search.substr(1),b={};a.split("&").forEach(function(a){var c=a.split("=");b[c[0]]=decodeURIComponent(c[1])}),void 0!==b.day&&(reference=new Date(b.day)),updateDisplay(getWeek(chrono.parseDate("today",reference)))});var timeStr=["8:00","8:30","9:00","9:30","10:00","10:30","11:00","11:30","12:00","12:30","1:00","1:30","2:00","2:30","3:00","3:30","4:00","4:30","5:00","5:30","6:00","6:30","7:00","7:30","8:00","8:30","9:00"],dayStr=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];$(".unfilled").click(function(a){if(-1!=a.target.classList.value.indexOf("unfilled")){var b=parseId(a.target.id);swal({title:"Almost there...",text:"Enter your Andover email:",type:"input",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:"jdoe@andover.edu",allowOutsideClick:!0,customClass:"popup",confirmButtonColor:"#4ea1d3",confirmButtonText:"Reserve Time"},function(a){if(!1===a)return!1;var c=new RegExp("^[a-zA-Z0-9]+@andover.edu$","g");if(""===a)return swal.showInputError("You need to write something!"),!1;if(!c.test(a))return swal.showInputError("You must use a valid Andover email"),!1;var d={email:a,day:b.day,time:b.time};$.post("/savetime",d,function(a){window.location.pathname="/reserve",window.location.search="day="+reference}).fail(function(){swal("Oops!","Something went wrong","error")})})}});